# History Quiz FAISS λ²„μ „ - λ¬΄λ£ λ΅μ»¬ μ„λ² λ”© μ‹μ¤ν…

FAISSμ™€ λ΅μ»¬ μ„λ² λ”© λ¨λΈμ„ μ‚¬μ©ν•μ—¬ OpenAI API λΉ„μ© μ—†μ΄ μ—­μ‚¬ μΈλ¬Ό ν€΄μ¦ μ‹μ¤ν…μ„ κµ¬ν„ν•©λ‹λ‹¤.

## π† **OpenAI vs FAISS λΉ„κµ**

| νΉμ§• | OpenAI μ„λ² λ”© | FAISS + λ΅μ»¬ λ¨λΈ |
|------|---------------|-------------------|
| **λΉ„μ©** | π’° API νΈμ¶ λΉ„μ© λ°μƒ | π†“ μ™„μ „ λ¬΄λ£ |
| **μΈν„°λ„·** | π ν•­μƒ μ—°κ²° ν•„μ” | π“± μ¤ν”„λΌμΈ μ‹¤ν–‰ κ°€λ¥ |
| **μ†λ„** | π API νΈμ¶ μ§€μ—° | β΅ λ΅μ»¬ μ²λ¦¬λ΅ λΉ λ¦„ |
| **μ •ν™•λ„** | π― λ§¤μ° λ†’μ | π“ μ–‘νΈν•¨ (λ¨λΈμ— λ”°λΌ) |
| **λ°μ΄ν„° λ³΄μ•** | π”’ ν΄λΌμ°λ“ μ „μ†΅ | π›΅οΈ λ΅μ»¬ μ²λ¦¬ |
| **μ„¤μ •** | π”§ API ν‚¤λ§ ν•„μ” | β™οΈ λ¨λΈ λ‹¤μ΄λ΅λ“ ν•„μ” |
| **ν™•μ¥μ„±** | π“ API μ ν• μμ | π€ λ¬΄μ ν• μ²λ¦¬ |

## π€ **FAISS λ²„μ „ μ„¤μΉ λ° μ„¤μ •**

### 1. μμ΅΄μ„± ν¨ν‚¤μ§€ μ„¤μΉ

```bash
# FAISS λ²„μ „μ© ν¨ν‚¤μ§€ μ„¤μΉ
pip install faiss-cpu sentence-transformers torch pandas numpy scikit-learn

# λλ” requirements.txt μ‚¬μ©
pip install -r requirements.txt
```

### 2. μ‚¬μ© κ°€λ¥ν• ν•κµ­μ–΄ μ„λ² λ”© λ¨λΈ

#### **μ¶”μ² λ¨λΈλ“¤:**

1. **`jhgan/ko-sroberta-multitask`** (κΈ°λ³Έκ°’)
   - ν•κµ­μ–΄ μµμ ν™” λ¨λΈ
   - 768μ°¨μ›
   - λ‹¤μ–‘ν• ν•κµ­μ–΄ νƒμ¤ν¬μ— νΉν™”

2. **`snunlp/KR-SBERT-V40K-klueNLI-augSTS`**
   - ν•κµ­μ–΄ SBERT λ¨λΈ
   - 768μ°¨μ›
   - μμ—°μ–΄ μ¶”λ΅ μ— νΉν™”

3. **`sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`**
   - λ‹¤κµ­μ–΄ μ§€μ› λ¨λΈ
   - 384μ°¨μ› (κ°€μ¥ κ°€λ²Όμ›€)
   - ν•κµ­μ–΄ ν¬ν•¨ λ‹¤κµ­μ–΄ μ²λ¦¬

### 3. GPU μ‚¬μ© (μ„ νƒμ‚¬ν•­)

GPUκ°€ μλ‹¤λ©΄ λ” λΉ λ¥Έ μ²λ¦¬κ°€ κ°€λ¥ν•©λ‹λ‹¤:

```bash
# GPU λ²„μ „ μ„¤μΉ
pip uninstall faiss-cpu
pip install faiss-gpu

# CUDA μ§€μ› PyTorch μ„¤μΉ
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

## π® **μ‚¬μ© λ°©λ²•**

### FAISS λ²„μ „ λ°λ¨ μ‹¤ν–‰

```bash
python history_quiz_faiss_demo.py
```

### κ°λ³„ λ¨λ“ ν…μ¤νΈ

```bash
# FAISS μ„λ² λ”© ν…μ¤νΈ
python faiss_embedding.py
```

## π“ **FAISS λ²„μ „μ μ£Όμ” κΈ°λ¥**

### 1. **λ΅μ»¬ μ„λ² λ”© μ²λ¦¬** (`faiss_embedding.py`)

- **μ™„μ „ λ¬΄λ£**: API λΉ„μ© μ—†μ
- **μ¤ν”„λΌμΈ μ‹¤ν–‰**: μΈν„°λ„· μ—°κ²° λ¶ν•„μ” (μ΄κΈ° λ¨λΈ λ‹¤μ΄λ΅λ“ ν›„)
- **λΉ λ¥Έ μ²λ¦¬**: λ΅μ»¬ GPU/CPU μ‚¬μ©
- **λ°μ΄ν„° λ³΄μ•**: λ¨λ“  λ°μ΄ν„°κ°€ λ΅μ»¬μ—μ„ μ²λ¦¬

### 2. **FAISS λ²΅ν„° κ²€μƒ‰**

- **κ³ μ† κ²€μƒ‰**: λ€μ©λ‰ λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤μ—μ„ λΉ λ¥Έ κ²€μƒ‰
- **λ©”λ¨λ¦¬ ν¨μ¨**: μ••μ¶•λ μΈλ±μ¤ μ‚¬μ©
- **ν™•μ¥μ„±**: μλ§ κ°μ λ²΅ν„°λ„ λΉ λ¥΄κ² μ²λ¦¬

### 3. **μΊμ‹± μ‹μ¤ν…**

- **μ„λ² λ”© μΊμ‹±**: ν• λ² κ³„μ‚°λ μ„λ² λ”© μ¬μ‚¬μ©
- **μΈλ±μ¤ μ €μ¥**: FAISS μΈλ±μ¤λ¥Ό νμΌλ΅ μ €μ¥
- **μλ™ λ΅λ“**: ν”„λ΅κ·Έλ¨ μ¬μ‹μ‘ μ‹ μλ™μΌλ΅ μΊμ‹ λ΅λ“

## π”§ **μ„¤μ • μµμ…**

### λ¨λΈ μ„ νƒ

```python
# ν•κµ­μ–΄ μµμ ν™” λ¨λΈ (κΈ°λ³Έκ°’)
faiss_manager = FAISSEmbeddingManager("jhgan/ko-sroberta-multitask")

# ν•κµ­μ–΄ SBERT λ¨λΈ
faiss_manager = FAISSEmbeddingManager("snunlp/KR-SBERT-V40K-klueNLI-augSTS")

# λ‹¤κµ­μ–΄ λ¨λΈ (κ°€λ²Όμ›€)
faiss_manager = FAISSEmbeddingManager("sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2")
```

### GPU μ‚¬μ© μ„¤μ •

```python
# GPU μ‚¬μ© ν™•μΈ
import torch
print(f"CUDA μ‚¬μ© κ°€λ¥: {torch.cuda.is_available()}")

# GPU λ©”λ¨λ¦¬ ν™•μΈ
if torch.cuda.is_available():
    print(f"GPU λ©”λ¨λ¦¬: {torch.cuda.get_device_properties(0).total_memory / 1024**3:.1f}GB")
```

## π“ **μ„±λ¥ λΉ„κµ**

### μ²λ¦¬ μ†λ„ (μμƒ)

| μ‘μ—… | OpenAI API | FAISS (CPU) | FAISS (GPU) |
|------|------------|-------------|-------------|
| λ‹¨μΌ μ„λ² λ”© | 1-2μ΄ | 0.1-0.3μ΄ | 0.05-0.1μ΄ |
| 100κ° μ„λ² λ”© | 100-200μ΄ | 10-30μ΄ | 5-10μ΄ |
| λ²΅ν„° κ²€μƒ‰ | 0.5-1μ΄ | 0.001-0.01μ΄ | 0.0001-0.001μ΄ |

### μ •ν™•λ„ (μμƒ)

| λ¨λΈ | ν•κµ­μ–΄ μ •ν™•λ„ | λ‹¤κµ­μ–΄ μ§€μ› | λ¨λΈ ν¬κΈ° |
|------|---------------|-------------|-----------|
| OpenAI text-embedding-3-small | 95% | μ°μ | ν΄λΌμ°λ“ |
| jhgan/ko-sroberta-multitask | 90% | ν•κµ­μ–΄ νΉν™” | 1.2GB |
| KR-SBERT-V40K-klueNLI-augSTS | 88% | ν•κµ­μ–΄ νΉν™” | 1.2GB |
| paraphrase-multilingual-MiniLM | 85% | μ°μ | 470MB |

## π› **λ¬Έμ  ν•΄κ²°**

### μΌλ°μ μΈ λ¬Έμ 

1. **λ¨λΈ λ‹¤μ΄λ΅λ“ μ‹¤ν¨**
   ```
   β λ¨λΈ λ΅λ”© μ‹¤ν¨
   ```
   β†’ μΈν„°λ„· μ—°κ²° ν™•μΈ, λ°©ν™”λ²½ μ„¤μ • ν™•μΈ

2. **λ©”λ¨λ¦¬ λ¶€μ΅±**
   ```
   β CUDA out of memory
   ```
   β†’ CPU λ²„μ „ μ‚¬μ©: `faiss-cpu` μ„¤μΉ

3. **FAISS μΈλ±μ¤ μ¤λ¥**
   ```
   β FAISS μΈλ±μ¤κ°€ κµ¬μ¶•λμ§€ μ•μ•μµλ‹λ‹¤
   ```
   β†’ μΈλ±μ¤ νμΌ μ‚­μ  ν›„ μ¬κµ¬μ¶•

### μ„±λ¥ μµμ ν™” ν

1. **GPU μ‚¬μ©**: CUDA μ§€μ› GPUκ°€ μλ‹¤λ©΄ `faiss-gpu` μ‚¬μ©
2. **λ°°μΉ μ²λ¦¬**: μ—¬λ¬ ν…μ¤νΈλ¥Ό ν• λ²μ— μ²λ¦¬
3. **μΊμ‹± ν™μ©**: ν• λ² κ³„μ‚°λ μ„λ² λ”© μ¬μ‚¬μ©
4. **λ¨λΈ μ„ νƒ**: μ©λ„μ— λ§λ” λ¨λΈ μ„ νƒ (μ†λ„ vs μ •ν™•λ„)

## π“ **μƒμ„±λλ” νμΌλ“¤**

### μΊμ‹ νμΌ
- `faiss_embeddings_cache_*.pkl`: μ„λ² λ”© μΊμ‹
- `faiss_index_*.faiss`: FAISS μΈλ±μ¤
- `person_names_*.json`: μΈλ¬Ό μ΄λ¦„ λ§¤ν•‘
- `person_faiss_embeddings.json`: μΈλ¬Ό μ„λ² λ”© λ°μ΄ν„°

### κ²°κ³Ό νμΌ
- `quiz_faiss_results.json`: ν€΄μ¦ κ²°κ³Ό
- `automated_faiss_demo_results.json`: μλ™ν™” λ°λ¨ κ²°κ³Ό

## π― **μ‚¬μ© μ‹λ‚λ¦¬μ¤**

### 1. **κ°λ°/ν…μ¤νΈ ν™κ²½**
- API λΉ„μ© μ—†μ΄ κ°λ° λ° ν…μ¤νΈ
- μ¤ν”„λΌμΈ ν™κ²½μ—μ„ μ‘μ—…
- λΉ λ¥Έ λ°λ³µ κ°λ°

### 2. **ν”„λ΅λ•μ… ν™κ²½**
- λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬
- λ†’μ€ μ²λ¦¬λ‰ μ”κµ¬
- λ°μ΄ν„° λ³΄μ• μ¤‘μ”

### 3. **κµμ΅/μ—°κµ¬ λ©μ **
- μ„λ² λ”© λ¨λΈ ν•™μµ
- λ²΅ν„° κ²€μƒ‰ μ•κ³ λ¦¬μ¦ μ—°κµ¬
- λΉ„μ© μ—†λ” μ‹¤ν—

## π”„ **OpenAI λ²„μ „κ³Όμ νΈν™μ„±**

FAISS λ²„μ „μ€ OpenAI λ²„μ „κ³Ό λ™μΌν• μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•©λ‹λ‹¤:

```python
# OpenAI λ²„μ „
from openai_embedding import OpenAIEmbeddingManager
manager = OpenAIEmbeddingManager("text-embedding-3-small")

# FAISS λ²„μ „ (λ™μΌν• μ‚¬μ©λ²•)
from faiss_embedding import FAISSEmbeddingManager
manager = FAISSEmbeddingManager("jhgan/ko-sroberta-multitask")

# λ™μΌν• λ©”μ„λ“ μ‚¬μ©
embedding = manager.get_embedding("ν…μ¤νΈ")
similarity = manager.calculate_similarity(emb1, emb2)
```

## π“ **μ§€μ›**

FAISS λ²„μ „μ— λ€ν• λ¬Έμμ‚¬ν•­μ΄λ‚ λ¬Έμ κ°€ μμΌμ‹λ©΄ μ΄μλ¥Ό ν†µν•΄ μ—°λ½ν•΄μ£Όμ„Έμ”.

---

**π’΅ ν**: μ²μ μ‹¤ν–‰ μ‹ λ¨λΈ λ‹¤μ΄λ΅λ“μ— μ‹κ°„μ΄ κ±Έλ¦΄ μ μμµλ‹λ‹¤. μ΄ν›„μ—λ” μΊμ‹λ¥Ό μ‚¬μ©ν•μ—¬ λΉ λ¥΄κ² μ‹¤ν–‰λ©λ‹λ‹¤!
